{
    "name": "laravel-stack",
    "version": "1.0.0",
    "type": "php",
    "framework": "laravel",
    "description": "Production-ready Laravel application stack with Docker Swarm",

    "metadata": {
        "maintainer": "tuti-cli",
        "repository": "https://github.com/tuti-cli/laravel-stack",
        "php_version": "8.4"
    },

    "app_service": {
        "name": "app",
        "stub": "app/laravel-app.stub",
        "image": "serversideup/php",
        "variants": {
            "fpm-nginx": "{{PHP_VERSION}}-fpm-nginx",
            "fpm-apache": "{{PHP_VERSION}}-fpm-apache",
            "cli":  "{{PHP_VERSION}}-cli"
        },
        "default_variant": "fpm-nginx"
    },

    "required_services": {
        "database": {
            "category": "databases",
            "options": ["postgres", "mysql", "mariadb"],
            "default": "postgres",
            "prompt": "Which database would you like to use?"
        },
        "cache":  {
            "category": "cache",
            "options": ["redis"],
            "default": "redis",
            "prompt": "Which cache driver would you like to use?"
        }
    },

    "optional_services": {
        "search": {
            "category": "search",
            "options": ["meilisearch", "typesense"],
            "default":  null,
            "prompt": "Would you like to add a search engine?"
        },
        "storage": {
            "category": "storage",
            "options": ["minio"],
            "default": null,
            "prompt": "Would you like to add S3-compatible storage?"
        },
        "mail": {
            "category": "mail",
            "options": ["mailpit"],
            "default": "mailpit",
            "prompt":  "Would you like to add mail testing?"
        }
    },

    "service_overrides": {
        "cache.redis": {
            "description": "Laravel-optimized Redis configuration with queue support",
            "variables": {
                "REDIS_APPEND_ONLY": "--appendonly yes",
                "REDIS_EVICTION_POLICY": "--maxmemory-policy allkeys-lru",
                "REDIS_PASSWORD_CONFIG": "${REDIS_PASSWORD:+--requirepass $REDIS_PASSWORD}"
            },
            "env_variables": {
                "CACHE_STORE": "redis",
                "SESSION_DRIVER": "redis",
                "QUEUE_CONNECTION": "redis",
                "REDIS_CLIENT":  "phpredis",
                "REDIS_CACHE_DB": "1",
                "REDIS_SESSION_DB": "2",
                "REDIS_QUEUE_DB": "3"
            },
            "environments": {
                "dev": {
                    "variables": {
                        "REDIS_MAX_MEMORY": "--maxmemory 256mb"
                    },
                    "resources": {
                        "limits": {
                            "memory": "256M"
                        }
                    }
                },
                "staging": {
                    "variables": {
                        "REDIS_MAX_MEMORY": "--maxmemory 512mb"
                    },
                    "resources": {
                        "limits": {
                            "memory":  "512M"
                        }
                    }
                },
                "production": {
                    "variables": {
                        "REDIS_MAX_MEMORY": "--maxmemory 1024mb"
                    },
                    "resources": {
                        "limits":  {
                            "memory": "1024M"
                        },
                        "reservations": {
                            "memory":  "512M"
                        }
                    }
                }
            }
        },
        "databases.postgres": {
            "description": "PostgreSQL optimized for Laravel",
            "environments": {
                "production": {
                    "resources": {
                        "limits": {
                            "cpus": "2",
                            "memory": "2048M"
                        },
                        "reservations": {
                            "cpus": "1",
                            "memory": "1024M"
                        }
                    },
                    "deploy": {
                        "placement": {
                            "constraints": [
                                "node.labels.database == true"
                            ]
                        }
                    }
                }
            }
        }
    },

    "environments": {
        "dev": {
            "app_replicas": 1,
            "features": {
                "hot_reload": true,
                "debug": true,
                "telescope": true
            },
            "env_template": "environments/.env.dev.example"
        },
        "staging": {
            "app_replicas": 2,
            "features": {
                "hot_reload": false,
                "debug": false,
                "ssl": true,
                "telescope":  false
            },
            "env_template": "environments/.env.staging.example"
        },
        "production": {
            "app_replicas": 3,
            "features": {
                "hot_reload": false,
                "debug": false,
                "ssl": true,
                "opcache": true,
                "telescope": false
            },
            "env_template": "environments/.env.prod.example"
        }
    },

    "hooks": {
        "pre_init": [],
        "post_init": [],
        "pre_deploy": ["hooks/pre-deploy.sh"],
        "post_deploy": ["hooks/post-deploy.sh"],
        "health_check": ["hooks/health-check.sh"]
    },

    "required_variables": [
        "APP_NAME",
        "APP_KEY",
        "APP_URL",
        "DB_PASSWORD",
        "APP_DOMAIN"
    ],

    "generated_variables": {
        "APP_KEY": {
            "generator": "laravel_key",
            "command": "php artisan key:generate --show",
            "description": "Laravel application encryption key"
        },
        "DB_PASSWORD": {
            "generator": "secure_random",
            "length": 32,
            "description": "Database password"
        },
        "REDIS_PASSWORD": {
            "generator": "secure_random_or_null",
            "length": 32,
            "description": "Redis password (optional for dev)"
        }
    }
}
